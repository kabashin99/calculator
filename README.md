# Проект Калькулятор

Это распределённый вычислитель арифметических выражений. Система принимает выражение, разбивает его на отдельные задачи, и вычисляет результат асинхронно с помощью агента, работающего в нескольких горутинах. Веб-интерфейс позволяет пользователю отправлять выражения и наблюдать за их состоянием.

## Функциональность

Сервер принимает на вход строку, содержащую арифметическое выражение. Строка может включать:

• Цифры (рациональные числа), представленные в виде односимвольных идентификаторов.

• Арифметические операции: сложение (+), вычитание (-), умножение (*) и деление (/).

• Скобки ( и ), которые используются для задания приоритета выполнения операций.

**API Оркестратора:** 

    POST /api/v1/calculate — отправка арифметического выражения (например, "2+2*2") для вычисления.

    GET /api/v1/expressions — получение списка всех выражений с их статусами и результатами.

    GET /api/v1/expressions/{id} — получение подробной информации по конкретному выражению.

    GET /internal/task — выдача задачи агенту для вычисления.

    POST /internal/task — приём результата вычисленной задачи.

**Агент (Worker):**

Агент в цикле запрашивает задачи с эндпоинта /internal/task, выполняет операцию (с имитацией задержки, зависящей от переменных окружения) и отправляет результат обратно.

## Установка и запуск

Скопируйте проект
```bash
git clone https://github.com/kabashin99/calculator.git
cd calculator
```

Установите все необходимые зависимости
```bash
go mod tidy
```

### Запуск оркестратора (сервера)

- **Linux/macOS: / Windows (PowerShell)**
```bash
go run cmd/orchestrator/main.go

```

Сообщение при успешном запуске сервера
```bash
2025/03/05 15:08:24 Config loaded: &{100 100 200 200 4}
2025/03/05 15:08:24 Оркестратор запущен на :8080
```

### Запуск агента (демона)

В отдельном терминале запустите агента. 

- **Linux/macOS: / Windows (PowerShell)**

  ```bash
  go run cmd/agent/main.go
  
  ```


### Параметры приложения
Настройки расположены в файле *config/config.txt* 
```
# Конфигурация оркестратора
TIME_ADDITION_MS=100  #  время выполнения операции сложения в миллисекундах 
TIME_SUBTRACTION_MS=100  # время выполнения операции вычитания в миллисекундах 
TIME_MULTIPLICATION_MS=200  #  время выполнения операции умножения в 
TIME_DIVISION_MS=200  # время выполнения операции деления в миллисекундах

# Конфигурация агента
COMPUTING_POWER=4  # Количество горутин 
```


## Примеры запросов/ ответов

### 1. Отправка выражения на вычисление

```bash
curl --location 'http://localhost:8080/api/v1/calculate' `
--header 'Content-Type: application/json' `
--data '{"expression": "2+2*2"}'
```

_Ожидаемый ответ (при успешном принятии выражения):_

```json
{"id":"550cf23a-4cd3-40d8-b1df-820d44c23479"}
```
### 2. Получение списка выражений

```bash
curl --location 'http://localhost:8080/api/v1/expressions'
```

_Пример ответа:_

```bash
{
    "expressions": [
        {"id": 550cf23a-4cd3-40d8-b1df-820d44c23479, "status": "completed", "result": 6},
        {"id": 111cf23a-4cd3-40d8-b2df-820d44c23234, "status": "pending", "result": NaN}
    ]
}
```
### 3. Получение информации по конкретному выражению


```bash
curl --location 'http://localhost:8080/api/v1/expressions/550cf23a-4cd3-40d8-b1df-820d44c23479'

```

_Пример ответа:_

```bash
{"expression":{"id":"550cf23a-4cd3-40d8-b1df-820d44c23479","status":"done","result":6}}

```

## Тесты

Запуск тестов из корневой директории :
```bash
go test -cover calculator_app/...

```

Автор: Абашин Ярослав
Telegram: @kabashin
